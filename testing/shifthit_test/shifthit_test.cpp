
#include <QString>
#include <QtTest>

#include <fstream>

#include <Magick++.h>

#include "shifthit.hpp"
#include "log/log.hpp"

class ShiftHit_test : public QObject {
    Q_OBJECT

public:
    ShiftHit_test();

private:
    void paint( const std::list<PointF>& points, const std::string& filename );

private Q_SLOTS:
    void testMinus();
    void testGeometricMedian();
};

ShiftHit_test::ShiftHit_test() {
}

void ShiftHit_test::paint(const std::list<PointF> &points, const std::string &filename) {
    std::pair<PointF,float> median = ShiftHit::geometricMedian( points );
    LOG( median.first.toString() );

    // draw
    Magick::InitializeMagick( 0 );
    Magick::Image image( Magick::Geometry( 1930, 1287 ), Magick::Color( "white" ) );

    for( PointF point : points ) {
        image.draw( Magick::DrawableRectangle( point.x(), point.y(), point.x() + 5, point.y() + 5 ) );
    }

    image.fillColor( "red" );
    image.draw( Magick::DrawableRectangle( median.first.x(), median.first.y(), median.first.x() + 5, median.first.y() + 5 ) );

    image.write( filename );
}

void ShiftHit_test::testMinus() {
    Shift shift( 1, 1 );
    ShiftHit hit(shift);
    QVERIFY( true );
}

void ShiftHit_test::testGeometricMedian() {

    std::list<PointF> points  = { {230,982}, {203,1264}, {337,1055}, {309,1050}, {475,183}, {860,334}, {308,1050}, {840,681}, {281,1155}, {224,983}, {308,1049}, {701,215}, {942,784}, {575,485}, {364,847}, {369,1026}, {452,1140}, {582,476}, {1284,346}, {230,979}, {307,1048}, {806,237}, {148,248}, {296,1058}, {300,1012}, {369,1025}, {305,1048}, {255,992}, {321,1039}, {318,1039}, {256,1005}, {250,1011}, {249,1047}, {237,978}, {251,1075}, {288,1029}, {250,1010}, {569,617}, {250,1041}, {237,979}, {392,485}, {901,1192}, {314,968}, {259,1049}, {220,1059}, {324,1061}, {236,980}, {225,1054}, {246,1011}, {1041,1239}, {283,1048}, {290,1027}, {296,1054}, {241,1061}, {229,1017}, {266,988}, {230,1017}, {501,424}, {260,1043}, {284,1049}, {261,1050}, {231,1055}, {255,1055}, {291,1016}, {482,821}, {230,996}, {323,973}, {237,982}, {235,983}, {770,790}, {251,972}, {314,959}, {246,978}, {288,1012}, {1263,390}, {296,989}, {297,990}, {235,984}, {318,973}, {161,888}, {265,341}, {209,207}, {311,961}, {310,1060}, {298,985}, {236,984}, {15,795}, {1206,221}, {239,983}, {240,1012}, {218,1031}, {552,491}, {240,983}, {239,1013}, {287,977}, {288,977}, {289,977}, {235,986}, {272,998}, {284,978}, {217,1032}, {258,1040}, {287,978}, {289,978}, {290,978}, {227,993}, {236,986}, {238,987}, {239,987}, {226,996}, {289,979}, {237,988}, {310,215}, {636,617}, };
    ShiftHit_test::paint( points, "median_4th.png" );

    std::list<PointF> points2 = { {671,209}, {1068,655}, {988,81}, {148,1061}, {24,856}, {846,688}, {154,873}, {545,281}, {167,1089}, {693,460}, {1104,1098}, {387,494}, {165,1088}, {350,1150}, {407,1189}, {1771,549}, {166,1087}, {165,1087}, {1029,376}, {61,830}, {1049,109}, {173,1078}, {567,883}, {909,79}, {165,1086}, {297,907}, {1162,1006}, {1034,76}, {173,1083}, {1688,600}, {446,1107}, {1059,1254}, {1716,516}, {1449,1121}, {1012,767}, {169,1089}, {167,1082}, {169,1090}, {168,1092}, {865,796}, {176,1026}, {159,1019}, {616,762}, {983,73}, {862,48}, {1508,1045}, {160,1018}, {191,1032}, {190,1032}, {160,1020}, {428,777}, {168,1078}, {175,1028}, {1464,590}, {310,807}, {184,1033}, {161,1020}, {190,1031}, {1419,367}, {742,110}, {409,772}, {1418,367}, {887,713}, {1141,365}, {1007,131}, {141,793}, {164,1075}, {888,458}, {1076,1060}, {666,545}, {136,1072}, {137,1072}, {173,1089}, {731,877}, {658,554}, {656,556}, {657,555}, {1849,563}, {174,1089}, {873,184}, {162,1021}, {163,1021}, {174,1090}, {1105,859}, {177,1088}, {229,834}, {1461,509}, {177,1090}, {1777,569}, {164,1022}, {896,138}, {1141,708}, {236,985}, {1593,552}, };
    ShiftHit_test::paint( points2, "median_20th.png" );

}


QTEST_MAIN( ShiftHit_test )

#include "shifthit_test.moc"
